---
name: roadmap-manager
description: ロードマップ（`.agent/roadmap.md`）を運用するスキル。タスクの追加・変更・削除・次タスク着手・完了同期を一貫して扱い、ExecPlan未作成タスクは着手前に計画を作成する。
---

# Roadmap Manager

`.agent/roadmap.md` をSSOTとして、ロードマップの保守と実行を行う。
実装規約は `AGENTS.md` を最優先とする。

## 記述フォーマット（固定）

ロードマップ項目は必ず次の形で記述する。

```md
### <タスク名>
- Status: `NEXT | WIP | DONE | BLOCKED`
- 着手予定日: `YYYY-MM-DD` または `未定`
- 完了日: `YYYY-MM-DD` または `未完了`
- 目的:
- 背景/課題:
- 到達条件（Definition of Done）:
- 非対象（やらないこと）:
- 依存関係:
- ExecPlan: `.agent/plans/YYYY-MM-DD-task-name.md` または `なし`
- メモ/判断ログ:
```

運用制約:
- ロードマップでは実装手順の箇条書きを持たない（手順はExecPlanへ集約）
- 進捗管理は `Status` を正とし、チェックボックスは互換表示が必要な場合のみ使う
- 追加・更新・削除時は上記全項目を欠落させない
- 日付欄が未確定の場合は `未定` / `未完了` を使う

## 実行ルール

1. 正本は `.agent/roadmap.md` のみを更新する。
2. 並び順は依存順を維持し、タスク追加時も依存関係が読める位置へ配置する。
3. 着手系操作では、対象タスクに ExecPlan が無ければ先に作成する。
4. タスク完了時は `Status: DONE` に更新し、必要なら親タスクも完了状態へ更新する。
5. 変更系操作（追加/変更/削除）では、関連する ExecPlan パスも同時に整合させる。
6. `最終更新` は変更が発生した日付へ更新する。

## コマンド

### /roadmap-next
1. 依存順で次の未完了タスクを1件選定する。
2. ExecPlan 行を確認し、無ければ `.agent/PLANS.md` 準拠で新規作成して `ExecPlan:` 行を追記する。
3. ExecPlan の `Progress` 初期行を更新して着手する。

### /roadmap-add <セクション> <タスク>
1. 指定セクション配下へ固定フォーマットでタスクを追加する。
2. 実装タスクの場合は `ExecPlan:` 行を追加し、対応プランを作成する。
3. 依存順が崩れないかを確認する。

### /roadmap-update <対象> <変更内容>
1. 対象タスクの `着手予定日` `完了日` `目的` `背景/課題` `到達条件` `非対象` `依存関係` `メモ/判断ログ` を更新する。
2. 既存 ExecPlan の目的・検証条件と矛盾しないよう同期する。
3. 変更後も固定フォーマットが保たれていることを確認する。

### /roadmap-remove <対象>
1. 対象タスクをロードマップから削除する。
2. 対応 ExecPlan が存在する場合は削除せず、`Outcomes & Retrospective` に中止理由を追記してアーカイブ扱いにする。
3. 親子関係と番号構造を整える。

### /roadmap-sync
1. 実装・検証結果に基づき `Status` を `NEXT/WIP/DONE/BLOCKED` へ更新する。
2. `Status: DONE` に変更した項目は `完了日` を当日に更新する（未完了状態へ戻す場合は `未完了`）。
3. 互換表示としてチェックボックスが残っている場合のみ整合させる。
4. `最終更新` を当日に更新する。

### /roadmap-normalize
1. 旧ToDo形式の項目を固定フォーマットへ変換する。
2. 変換時に実装手順を `到達条件` と `メモ/判断ログ` へ再配置し、詳細は ExecPlan 参照へ寄せる。
3. 変換後に `Status` と `ExecPlan` の欠落がないことを確認する。

## 参照順（最小）

1. `AGENTS.md`
2. `.agent/roadmap.md`
3. `.agent/PLANS.md`
4. `assets/docs/architecture.md`（影響が大きい場合）

## 意思決定の閾値

**自律判断可能**:
- 依存順を維持した文言修正
- 完了チェック同期
- ExecPlan の有無判定と新規作成

**要相談**:
- 優先順位の大幅変更
- セクション再編（章立て変更）
- 複数タスクの一括削除
