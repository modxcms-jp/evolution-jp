# スキル設計ガイド

スキルの概念、設計原則、構造に関する詳細なリファレンス。

## 目次

- [スキルについて](#スキルについて)
- [核となる原則](#核となる原則)
- [スキルの構造](#スキルの構造)
- [プログレッシブディスクロージャー](#プログレッシブディスクロージャーのデザイン原則)

## スキルについて

スキルは、特化した知識、ワークフロー、ツールを提供することでClaudeの機能を拡張する、モジュール式の自己完結型パッケージです。特定のドメインやタスクの「オンボーディングガイド」と考えてください。これらは、Claudeを汎用エージェントから、どのモデルも完全には持ち得ない手続き的知識を備えた特化型エージェントに変換します。

### スキルが提供するもの

1. 特化したワークフロー - 特定ドメインのための複数ステップの手順
2. ツール統合 - 特定のファイル形式やAPIを扱うための指示
3. ドメインの専門知識 - 企業固有の知識、スキーマ、ビジネスロジック
4. バンドルされたリソース - 複雑で反復的なタスクのためのスクリプト、リファレンス、アセット

## 核となる原則

### 簡潔さが鍵

コンテキストウィンドウは公共財です。スキルは、Claudeが必要とする他のすべてのもの（システムプロンプト、会話履歴、他のスキルのメタデータ、実際のユーザーリクエスト）とコンテキストウィンドウを共有します。

**デフォルトの前提: Claudeはすでに非常に賢い。** Claudeがまだ持っていないコンテキストのみを追加してください。各情報に疑問を投げかけてください：「Claudeは本当にこの説明が必要か？」「この段落はトークンコストを正当化するか？」

冗長な説明よりも簡潔な例を優先してください。

### 適切な自由度の設定

タスクの脆弱性と変動性に応じて、具体性のレベルを調整してください：

**高い自由度（テキストベースの指示）**：複数のアプローチが有効な場合、決定がコンテキストに依存する場合、またはヒューリスティックがアプローチを導く場合に使用します。

**中程度の自由度（パラメータ付き疑似コードまたはスクリプト）**：優先されるパターンが存在する場合、ある程度の変動が許容される場合、または設定が動作に影響する場合に使用します。

**低い自由度（特定のスクリプト、少数のパラメータ）**：操作が脆弱でエラーが発生しやすい場合、一貫性が重要な場合、または特定のシーケンスに従う必要がある場合に使用します。

Claudeが道を探索していると考えてください：崖のある細い橋には特定のガードレールが必要（低い自由度）ですが、開けた野原では多くのルートが可能です（高い自由度）。

## スキルの構造

すべてのスキルは、必須のSKILL.mdファイルとオプションのバンドルされたリソースで構成されます：

```
skill-name/
├── SKILL.md (required)
│   ├── YAML frontmatter metadata (required)
│   │   ├── name: (required)
│   │   └── description: (required)
│   └── Markdown instructions (required)
└── Bundled Resources (optional)
    ├── scripts/          - Executable code (Python/Bash/etc.)
    ├── references/       - Documentation intended to be loaded into context as needed
    └── assets/           - Files used in output (templates, icons, fonts, etc.)
```

### SKILL.md（必須）

すべてのSKILL.mdは以下で構成されます：

- **Frontmatter**（YAML）：`name`と`description`フィールドを含みます。これらは、Claudeがスキルをいつ使用するかを決定するために読み取る唯一のフィールドであるため、スキルが何であるか、いつ使用すべきかを明確かつ包括的に記述することが非常に重要です。
- **Body**（Markdown）：スキルの使用方法に関する指示とガイダンス。スキルがトリガーされた後にのみロードされます（もしされる場合）。

### バンドルされたリソース（オプション）

#### スクリプト（`scripts/`）

決定論的な信頼性が必要なタスクや繰り返し書き直されるタスクのための実行可能なコード（Python/Bashなど）。

- **いつ含めるか**：同じコードが繰り返し書き直されている場合、または決定論的な信頼性が必要な場合
- **例**：マイグレーション実行のための`scripts/migrate.py`、使用箇所の棚卸しのための`scripts/inventory.py`
- **利点**：トークン効率が高く、決定論的で、コンテキストにロードせずに実行できる可能性がある
- **注意**：スクリプトは、パッチや環境固有の調整のためにClaudeによって読まれる必要がある場合があります

#### リファレンス（`references/`）

Claudeのプロセスと思考を通知するために、必要に応じてコンテキストにロードされることを意図したドキュメントとリファレンス資料。

- **いつ含めるか**：Claudeが作業中に参照すべきドキュメントの場合
- **例**：影響ファイル一覧のための`references/affected-files.md`、置換パターンのための`references/patterns.md`、処理フローのための`references/parse-flow.md`
- **使用例**：ファイルインベントリ、変換ルール、処理フロー図、テーブル定義
- **利点**：SKILL.mdを簡潔に保ち、Claudeが必要と判断した場合にのみロードされる
- **ベストプラクティス**：ファイルが大きい場合（>10k語）、SKILL.mdにgrep検索パターンを含める
- **重複を避ける**：情報はSKILL.mdまたはリファレンスファイルのいずれかに存在すべきで、両方には存在しないようにします。詳細情報にはリファレンスファイルを優先してください（スキルの中核でない限り）—これにより、SKILL.mdを簡潔に保ちながら、コンテキストウィンドウを占有せずに情報を発見可能にします。SKILL.mdには重要な手続き的指示とワークフローガイダンスのみを保持し、詳細なリファレンス資料、スキーマ、例をリファレンスファイルに移動してください。

#### アセット（`assets/`）

コンテキストにロードされることを意図していないが、Claudeが生成する出力内で使用されるファイル。

- **いつ含めるか**：スキルが最終出力で使用されるファイルを必要とする場合
- **例**：プラグイン雛形のための`assets/plugin-template.php`、設定ファイルテンプレートのための`assets/config-template.php`
- **使用例**：コード雛形、設定テンプレート、サンプルデータ
- **利点**：出力リソースをドキュメントから分離し、Claudeがコンテキストにロードせずにファイルを使用できるようにする

### スキルに含めるべきでないもの

スキルは、その機能を直接サポートする重要なファイルのみを含むべきです。以下を含む余計なドキュメントや補助ファイルを作成しないでください：

- README.md
- INSTALLATION_GUIDE.md
- QUICK_REFERENCE.md
- CHANGELOG.md
- など

スキルは、AIエージェントが目前のジョブを実行するために必要な情報のみを含むべきです。作成プロセス、セットアップおよびテスト手順、ユーザー向けドキュメントなどに関する補助的なコンテキストを含めるべきではありません。追加のドキュメントファイルを作成すると、単に混乱と雑然さが増すだけです。

## プログレッシブディスクロージャーのデザイン原則

スキルは、コンテキストを効率的に管理するために3レベルのロードシステムを使用します：

1. **メタデータ（name + description）** - 常にコンテキスト内（~100語）
2. **SKILL.mdのボディ** - スキルがトリガーされた時（<5k語）
3. **バンドルされたリソース** - Claudeが必要に応じて（無制限、スクリプトはコンテキストウィンドウに読み込まずに実行できるため）

### プログレッシブディスクロージャーのパターン

SKILL.mdのボディは重要な要素のみに留め、コンテキストの肥大化を最小限に抑えるために500行未満にしてください。この制限に近づいたら、コンテンツを別のファイルに分割してください。コンテンツを他のファイルに分割する場合、SKILL.mdからそれらを参照し、いつ読むべきかを明確に記述することが非常に重要です。これにより、スキルの読者がそれらの存在と使用時期を認識できます。

**重要な原則：** スキルが複数のバリエーション、フレームワーク、オプションをサポートする場合、SKILL.mdにはコアワークフローと選択ガイダンスのみを保持してください。バリエーション固有の詳細（パターン、例、設定）は別のリファレンスファイルに移動してください。

**パターン1：リファレンス付きの高レベルガイド**

```markdown
# PDO移行

## 基本ルール
db()ヘルパー経由でのみDB操作する。直接mysql_*を使わない。

## 詳細リファレンス
- **影響ファイル一覧**: [references/affected-files.md](references/affected-files.md)
- **置換パターン集**: [references/patterns.md](references/patterns.md)
```

Claudeは必要な時にのみaffected-files.mdやpatterns.mdをロードします。

**パターン2：機能領域ごとの組織化**

複数の領域にまたがるスキルの場合、領域ごとにコンテンツを整理します：

```
manager-refactor/
├── SKILL.md (ワークフロー + 領域選択)
└── references/
    ├── header.md (ヘッダー領域の構造・関連ファイル)
    ├── sidebar.md (サイドバー領域)
    └── main-area.md (メインエリア領域)
```

ヘッダーの改修時はheader.mdのみを読み取ります。

**パターン3：条件付き詳細**

基本的なコンテンツを表示し、高度なコンテンツにリンクします：

```markdown
# キャッシュ調査

## 基本的な確認手順
evo()->clearCache() の呼び出し状況を確認する。

## 詳細な調査が必要な場合
- **キャッシュ内部構造**: [references/cache-internals.md](references/cache-internals.md)
- **イベントフック**: [references/cache-events.md](references/cache-events.md)
```

Claudeは、詳細な調査が必要な場合にのみ追加リファレンスを読み取ります。

**重要なガイドライン：**

- **深くネストされたリファレンスを避ける** - リファレンスはSKILL.mdから1レベルの深さに保ちます。すべてのリファレンスファイルはSKILL.mdから直接リンクする必要があります。
- **長いリファレンスファイルを構造化する** - 100行を超えるファイルの場合、Claudeがプレビュー時に全体の範囲を確認できるように、先頭に目次を含めます。
